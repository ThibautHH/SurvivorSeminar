@page "/statistics"
@using Microsoft.AspNetCore.Components.Web

<!DOCTYPE html>
<html lang="fr">

@* number of events
gauge chart for quality of each coach
salary of each employee *@

<head>
    <link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soul Connection - Statistics</title>
    <link rel="stylesheet" href="Statistics.razor.css">
</head>

<body>
    <div class="container">
        <!-- Row 1 -->
        <div class="chart-section">
            <div class="donut-chart-container">
                    <h3>Number of meetings by employee</h3>
                <canvas id="meetingsDonutChart"></canvas>
            </div>
            <div class="employee-list-section">
                <div class="scrollable-list">
                    <h3>Employee List</h3>
                    <ul id="employeeList"></ul>
                </div>
            </div>
            <div class="line-chart-section">
                <h3>Client Meetings Over Time</h3>
                <canvas id="meetingsBarChart"></canvas>
            </div>
        </div>

        <!-- Row 2 -->
        <div class="chart-section">
            <div class="polar-list-section">
                <h3>Employee Salary</h3>
                <canvas id="SalaryPolar"></canvas>
            </div>
            <div class="polar-list-section">
                <h3>GAUGE</h3>
                <canvas id="RatingGauge"></canvas>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-gauge@0.4.0/dist/chartjs-gauge.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var employees = [
                {
                    name: 'John Doe',
                    meetings: 12,
                    meetingDates: ['2024-01-05', '2024-02-12', '2024-02-19', '2024-02-01', '2024-03-07', '2024-03-14'],
                    salary: 8450,
                    rating: 4.1
                },
                {
                    name: 'Jane Smith',
                    meetings: 19,
                    meetingDates: ['2024-01-02', '2024-01-09', '2024-01-16', '2024-02-03', '2024-02-10'],
                    salary: 6700,
                    rating: 1.5
                },
                {
                    name: 'Michael Johnson',
                    meetings: 3,
                    meetingDates: ['2024-04-04', '2024-04-25', '2024-07-08'],
                    salary: 8164,
                    rating: 2.1
                },
                {
                    name: 'Emily Davis',
                    meetings: 5,
                    meetingDates: ['2024-10-03', '2024-10-31', '2024-11-15'],
                    salary: 4210,
                    rating: 3.8
                },
                {
                    name: 'Jean Davis',
                    meetings: 5,
                    meetingDates: ['2024-10-03', '2024-03-17', '2024-10-31'],
                    salary: 6613,
                    rating: 2.9
                },
                {
                    name: 'Marc Davis',
                    meetings: 5,
                    meetingDates: ['2024-10-31', '2024-11-15'],
                    salary: 135,
                    rating: 0.4
                },
                {
                    name: 'Elthon Davis',
                    meetings: 5,
                    meetingDates: ['2024-10-03', '2024-03-17', '2024-11-15'],
                    salary: 7920,
                    rating: 3.7
                },
                {
                    name: 'John Davis',
                    meetings: 5,
                    meetingDates: ['2024-10-03', '2024-03-17', '2024-10-31', '2024-11-15'],
                    salary: 2680,
                    rating: 2.6
                },
                {
                    name: 'Carotte Davis',
                    meetings: 5,
                    meetingDates: ['2024-03-17', '2024-10-31', '2024-11-15'],
                    salary: 1760,
                    rating: 4.9
                },
                {
                    name: 'Android Davis',
                    meetings: 5,
                    meetingDates: ['2024-10-03', '2024-11-15'],
                    salary: 4912,
                    rating: 3.0
                },
            ];

            var barColors = [
                '#fd8644',
                '#f37159',
                '#ef6962',
                '#e95c6f',
                '#e45478',
                '#e04b81',
                '#dd4587'
            ];

            var employeeList = document.getElementById('employeeList');
            employees.forEach(function (employee, index) {
                var li = document.createElement('li');
                li.textContent = employee.name;
                li.dataset.index = index;
                employeeList.appendChild(li);
            });

            var labels = employees.map(function (employee) {
                return employee.name;
            });

            var data = employees.map(function (employee) {
                return employee.meetings;
            });

            var ctxDonut = document.getElementById('meetingsDonutChart').getContext('2d');
            var meetingsDonutChart = new Chart(ctxDonut, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Meetings by Employee',
                        data: data,
                        backgroundColor: barColors,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false,
                        }
                    }
                }
            });

            document.querySelectorAll('#employeeList li').forEach(function (li) {
                li.addEventListener('click', function () {
                    var index = this.dataset.index;
                    var selectedEmployee = employees[index];

                    // Highlight the clicked segment in the donut chart
                    meetingsDonutChart.setActiveElements([{ datasetIndex: 0, index: index }]);
                    meetingsDonutChart.update();

                    updateBarChart(selectedEmployee);
                    updateGaugeChart(selectedEmployee);
                });
            });

            var ctxBar = document.getElementById('meetingsBarChart').getContext('2d');

            var meetingsBarChart = new Chart(ctxBar, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Meetings Over Time',
                        data: [],
                        backgroundColor: function (context) {
                            var index = context.dataIndex;
                            return barColors[index % barColors.length];
                        },
                        borderRadius: 12,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            type: 'category',
                            title: {
                                display: true,
                                text: 'Month'
                            },
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Number of Meetings'
                            },
                            grid: {
                                display: false
                            },
                            ticks: {
                                callback: function (value) {
                                    return Math.floor(value);
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false,
                        }
                    }
                }
            });

            function updateBarChart(employee) {
                var dateCounts = {};
                employee.meetingDates.forEach(function (date) {
                    var month = new Date(date).toLocaleString('default', { month: 'short' });
                    dateCounts[month] = (dateCounts[month] || 0) + 1;
                });

                var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                var months = monthNames;
                var counts = months.map(function (month) {
                    return dateCounts[month] || 0;
                });

                meetingsBarChart.data.labels = months;
                meetingsBarChart.data.datasets[0].data = counts;
                meetingsBarChart.update();
            }

            updateBarChart(employees[0]);

            var ctxPolar = document.getElementById('SalaryPolar').getContext('2d');

            var salaryPolar = new Chart(ctxPolar, {
                type: 'polarArea',
                data: {
                    labels: employees.map(employee => employee.name), // Use employee names as labels
                    datasets: [{
                        label: 'Employee Salary',
                        data: employees.map(employee => employee.salary), // Use employee salaries as data
                        backgroundColor: function (context) {
                            var index = context.dataIndex;
                            return barColors[index % barColors.length]; // Use the color array for background colors
                        },
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        r: {
                            pointLabels: {
                                display: true,
                                centerPointLabels: true,
                                font: {
                                    size: 12
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false // Disable the legend here
                        }
                    }
                }
            });

            var ctxGauge = document.getElementById('RatingGauge').getContext('2d');

            // Example configuration for the gauge chart
            var ratingGauge = new Chart(ctxGauge, {
                type: 'gauge',
                data: {
                    labels: ['0', '1', '2', '3', '4', '5'], // These labels will appear on the gauge
                    datasets: [{
                        data: [5], // Maximum value is 5 for rating
                        value: employees[0].rating, // Set the initial rating of the first employee
                        backgroundColor: ['#ff0000', '#ff9900', '#ffff00', '#00ff00', '#00cc00'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    needle: {
                        radiusPercentage: 2,
                        widthPercentage: 3.2,
                        lengthPercentage: 80,
                        color: 'rgba(0, 0, 0, 1)'
                    },
                    valueLabel: {
                        formatter: Math.round
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    layout: {
                        padding: {
                            bottom: 10
                        }
                    }
                }
            });

            function updateGaugeChart(employee) {
                ratingGauge.data.datasets[0].value = employee.rating; // Update the gauge with the new rating
                ratingGauge.update();
            }

        });
    </script>
</body>

</html>
