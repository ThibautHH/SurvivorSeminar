@page "/statistics"
@using Microsoft.AspNetCore.Components.Web

<!DOCTYPE html>
<html lang="fr">

@* number of events
gauge chart for quality of each coach
salary of each employee *@

<head>
    <link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soul Connection - Statistics</title>
    <link rel="stylesheet" href="Statistics.razor.css">
</head>

<body>
    <div class="container">
        <!-- Row 1 -->
        <div class="chart-section">
            <div class="donut-chart-container">
                <canvas id="meetingsDonutChart"></canvas>
            </div>
            <div class="employee-list-section">
                <div class="scrollable-list">
                    <h3>Employee List</h3>
                    <ul id="employeeList"></ul>
                </div>
            </div>
        </div>

        <!-- Row 2 -->
        <div class="line-chart-section">
            <h3>Client Meetings Over Time</h3>
            <canvas id="meetingsBarChart"></canvas>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var employees = [
                {
                    name: 'John Doe',
                    meetings: 12,
                    meetingDates: ['2024-01-05', '2024-02-12', '2024-02-19', '2024-02-01', '2024-03-07', '2024-03-14']
                },
                {
                    name: 'Jane Smith',
                    meetings: 19,
                    meetingDates: ['2024-01-02', '2024-01-09', '2024-01-16', '2024-02-03', '2024-02-10']
                },
                {
                    name: 'Michael Johnson',
                    meetings: 3,
                    meetingDates: ['2024-04-04', '2024-04-25', '2024-07-08']
                },
                {
                    name: 'Emily Davis',
                    meetings: 5,
                    meetingDates: ['2024-10-03', '2024-03-17', '2024-10-31', '2024-11-15']
                },
            ];

            var barColors = [
                '#fd8644',
                '#f37159',
                '#ef6962',
                '#e95c6f',
                '#e45478',
                '#e04b81',
                '#dd4587'
            ];

            var employeeList = document.getElementById('employeeList');
            employees.forEach(function (employee, index) {
                var li = document.createElement('li');
                li.textContent = employee.name;
                li.dataset.index = index;
                employeeList.appendChild(li);
            });

            var labels = employees.map(function (employee) {
                return employee.name;
            });

            var data = employees.map(function (employee) {
                return employee.meetings;
            });

            var ctxDonut = document.getElementById('meetingsDonutChart').getContext('2d');
            var meetingsDonutChart = new Chart(ctxDonut, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Meetings by Employee',
                        data: data,
                        backgroundColor: barColors,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false,
                        }
                    }
                }
            });

            document.querySelectorAll('#employeeList li').forEach(function (li) {
                li.addEventListener('click', function () {
                    var index = this.dataset.index;
                    var selectedEmployee = employees[index];

                    // Highlight the clicked segment in the donut chart
                    meetingsDonutChart.setActiveElements([{ datasetIndex: 0, index: index }]);
                    meetingsDonutChart.update();

                    updateBarChart(selectedEmployee);
                });
            });

            var ctxBar = document.getElementById('meetingsBarChart').getContext('2d');

            var meetingsBarChart = new Chart(ctxBar, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Meetings Over Time',
                        data: [],
                        backgroundColor: function (context) {
                            var index = context.dataIndex;
                            return barColors[index % barColors.length];
                        },
                        borderRadius: 12,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            type: 'category',
                            title: {
                                display: true,
                                text: 'Month'
                            },
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Number of Meetings'
                            },
                            grid: {
                                display: false
                            },
                            ticks: {
                                callback: function (value) {
                                    return Math.floor(value);
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false,
                        }
                    }
                }
            });

            function updateBarChart(employee) {
                var dateCounts = {};
                employee.meetingDates.forEach(function (date) {
                    var month = new Date(date).toLocaleString('default', { month: 'short' });
                    dateCounts[month] = (dateCounts[month] || 0) + 1;
                });

                var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                var months = monthNames;
                var counts = months.map(function (month) {
                    return dateCounts[month] || 0;
                });

                meetingsBarChart.data.labels = months;
                meetingsBarChart.data.datasets[0].data = counts;
                meetingsBarChart.update();
            }

            updateBarChart(employees[0]);
        });
    </script>
</body>

</html>
